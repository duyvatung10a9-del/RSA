<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>RSA Encryption Tool</title>

<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1f4037, #99f2c8);
    display: flex;
    justify-content: center;
    padding: 40px 0;
}

.container {
    background: white;
    width: 800px;
    border-radius: 16px;
    padding: 35px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

h1 {
    text-align: center;
    margin-bottom: 30px;
}

.card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
}

.card h2 {
    margin-top: 0;
    font-size: 18px;
}

.input-group {
    margin-bottom: 15px;
}

.row {
    display: flex;
    gap: 40px;   /* kho·∫£ng c√°ch l·ªõn gi·ªØa p v√† q */
}

.col {
    flex: 1;
}

label {
    font-weight: 500;
    display: block;
    margin-bottom: 5px;
}

input, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    transition: 0.3s;
}

input:focus, textarea:focus {
    border-color: #1f4037;
    box-shadow: 0 0 5px rgba(31,64,55,0.4);
    outline: none;
}

button {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    background: #1f4037;
    color: white;
    cursor: pointer;
    margin-top: 10px;
    margin-right: 10px;
    transition: 0.3s;
}

button:hover {
    background: #14532d;
    transform: translateY(-2px);
}

.suggestions button {
    background: #6c757d;
    margin: 5px 5px 0 0;
}

.suggestions button:hover {
    background: #495057;
}

.result-box {
    background: white;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 14px;
    word-wrap: break-word;
    border: 1px solid #ddd;
}

.footer {
    text-align: center;
    font-size: 12px;
    margin-top: 10px;
    color: gray;
}
</style>
</head>

<body>

<div class="container">
    <h1>üîê RSA Encryption & Decryption Tool</h1>

    <!-- T·∫†O KH√ìA -->
    <div class="card">
        <h2>1Ô∏è‚É£ T·∫°o kh√≥a RSA</h2>

        <div class="row">
            <div class="col input-group">
                <label>S·ªë nguy√™n t·ªë p</label>
                <input id="pInput">
            </div>

            <div class="col input-group">
                <label>S·ªë nguy√™n t·ªë q</label>
                <input id="qInput">
            </div>
        </div>

        <div class="input-group">
            <label>Gi√° tr·ªã e</label>
            <input id="eInput">
        </div>

        <button onclick="generateKeys()">T√≠nh kh√≥a</button>
        <button onclick="useCommonE()">D√πng e = 65537</button>

        <div class="result-box">
            n: <span id="nValue"></span><br>
            œÜ(n): <span id="phiValue"></span><br>
            d: <span id="dValue"></span>
        </div>

        <div class="suggestions" id="eSuggestions"></div>
    </div>

    <!-- M√É H√ìA -->
    <div class="card">
        <h2>2Ô∏è‚É£ M√£ h√≥a / Gi·∫£i m√£</h2>

        <div class="input-group">
            <label>VƒÉn b·∫£n g·ªëc</label>
            <textarea id="textInput" rows="3"></textarea>
        </div>

        <button onclick="encrypt()">M√£ h√≥a</button>

        <div class="input-group">
            <label>Cipher</label>
            <textarea id="cipherInput" rows="3"></textarea>
        </div>

        <button onclick="decrypt()">Gi·∫£i m√£</button>

        <div id="result" class="result-box"></div>
    </div>

    <div class="footer">
        Demo h·ªçc t·∫≠p RSA ‚Äì s·ª≠ d·ª•ng s·ªë nh·ªè ƒë·ªÉ quan s√°t
    </div>
</div>

<script>

let n, e, d;

function gcd(a, b) {
    while (b !== 0n) {
        [a, b] = [b, a % b];
    }
    return a;
}

function modInverse(a, m) {
    let m0 = m, x0 = 0n, x1 = 1n;
    while (a > 1n) {
        let q = a / m;
        [a, m] = [m, a % m];
        [x0, x1] = [x1 - q * x0, x0];
    }
    if (x1 < 0n) x1 += m0;
    return x1;
}

function modPow(base, exp, mod) {
    let result = 1n;
    base %= mod;
    while (exp > 0n) {
        if (exp % 2n === 1n)
            result = (result * base) % mod;
        exp >>= 1n;
        base = (base * base) % mod;
    }
    return result;
}

function suggestE(phi) {
    let container = document.getElementById("eSuggestions");
    container.innerHTML = "<strong>G·ª£i √Ω e h·ª£p l·ªá:</strong><br>";

    let count = 0;
    for (let i = 3n; i < phi && count < 8; i += 2n) {
        if (gcd(i, phi) === 1n) {
            let btn = document.createElement("button");
            btn.innerText = i;
            btn.onclick = () => {
                document.getElementById("eInput").value = i;
            };
            container.appendChild(btn);
            count++;
        }
    }
}

function generateKeys() {
    let p = BigInt(document.getElementById("pInput").value);
    let q = BigInt(document.getElementById("qInput").value);
    e = BigInt(document.getElementById("eInput").value);

    n = p * q;
    let phi = (p - 1n) * (q - 1n);

    if (gcd(e, phi) !== 1n) {
        alert("e kh√¥ng nguy√™n t·ªë c√πng phi(n)");
        return;
    }

    d = modInverse(e, phi);

    document.getElementById("nValue").innerText = n;
    document.getElementById("phiValue").innerText = phi;
    document.getElementById("dValue").innerText = d;

    suggestE(phi);
}

function useCommonE() {
    document.getElementById("eInput").value = 65537;
}

function encrypt() {
    let text = document.getElementById("textInput").value;
    let result = [];

    for (let i = 0; i < text.length; i++) {
        let m = BigInt(text.charCodeAt(i));
        let c = modPow(m, e, n);
        result.push(c.toString());
    }

    document.getElementById("cipherInput").value = result.join(" ");
}

function decrypt() {
    let parts = document.getElementById("cipherInput").value.split(" ");
    let result = "";

    for (let part of parts) {
        if (part.trim() === "") continue;
        let m = modPow(BigInt(part), d, n);
        result += String.fromCharCode(Number(m));
    }

    document.getElementById("result").innerText = "Gi·∫£i m√£: " + result;
}

</script>

</body>
</html>
