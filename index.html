    <!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>RSA Encryption Tool</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #1f4037, #99f2c8);
    display: flex;
    justify-content: center;
    padding: 40px 0;
}

.container {
    background: white;
    width: 800px;
    border-radius: 16px;
    padding: 35px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
}

h1 { text-align: center; margin-bottom: 30px; }

.card {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 25px;
}

.card h2 { margin-top: 0; font-size: 18px; }

.input-group { margin-bottom: 15px; }

.row { display: flex; gap: 40px; }

.col { flex: 1; }

label {
    font-weight: 500;
    display: block;
    margin-bottom: 5px;
}

input, textarea {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}

button {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    background: #1f4037;
    color: white;
    cursor: pointer;
    margin-top: 10px;
    margin-right: 10px;
}

button:hover {
    background: #14532d;
}

.result-box {
    background: white;
    padding: 10px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 14px;
    border: 1px solid #ddd;
}

.error {
    color: red;
    font-size: 13px;
    margin-top: 5px;
}

.footer {
    text-align: center;
    font-size: 12px;
    margin-top: 10px;
    color: gray;
}
</style>
</head>

<body>

<div class="container">
<h1>üîê RSA Encryption & Decryption Tool</h1>

<div class="card">
<h2>1Ô∏è‚É£ T·∫°o kh√≥a RSA</h2>

<div class="row">
<div class="col input-group">
<label>S·ªë nguy√™n t·ªë p</label>
<input id="pInput">
</div>

<div class="col input-group">
<label>S·ªë nguy√™n t·ªë q</label>
<input id="qInput">
</div>
</div>

<div class="input-group">
<label>Gi√° tr·ªã e</label>
<input id="eInput">
</div>

<button onclick="generateKeys()">T√≠nh kh√≥a</button>
<button onclick="useCommonE()">D√πng e = 65537</button>

<div id="validationMsg" class="error"></div>

<div class="result-box">
n: <span id="nValue"></span><br>
œÜ(n): <span id="phiValue"></span><br>
d: <span id="dValue"></span>
</div>

<div id="eSuggestions"></div>
</div>

<div class="card">
<h2>2Ô∏è‚É£ M√£ h√≥a / Gi·∫£i m√£</h2>

<div class="input-group">
<label>VƒÉn b·∫£n g·ªëc</label>
<textarea id="textInput" rows="3"></textarea>
</div>

<button onclick="encrypt()">M√£ h√≥a</button>

<div class="input-group">
<label>Cipher</label>
<textarea id="cipherInput" rows="3"></textarea>
</div>

<button onclick="decrypt()">Gi·∫£i m√£</button>

<div id="result" class="result-box"></div>
</div>

<div class="footer">
Demo h·ªçc t·∫≠p RSA ‚Äì s·ª≠ d·ª•ng s·ªë nh·ªè ƒë·ªÉ quan s√°t
</div>

</div>

<script>

let n, e, d;

// ================= PRIME CHECK =================
function isPrime(num) {
    if (num < 2n) return false;
    for (let i = 2n; i * i <= num; i++) {
        if (num % i === 0n) return false;
    }
    return true;
}

function nearestPrime(num) {
    let lower = num;
    let upper = num;

    while (lower > 2n) {
        lower--;
        if (isPrime(lower)) break;
    }

    while (true) {
        upper++;
        if (isPrime(upper)) break;
    }

    return { lower, upper };
}

// ================= BASIC MATH =================
function gcd(a, b) {
    while (b !== 0n) [a, b] = [b, a % b];
    return a;
}

function modInverse(a, m) {
    let m0 = m, x0 = 0n, x1 = 1n;
    while (a > 1n) {
        let q = a / m;
        [a, m] = [m, a % m];
        [x0, x1] = [x1 - q * x0, x0];
    }
    if (x1 < 0n) x1 += m0;
    return x1;
}

function modPow(base, exp, mod) {
    let result = 1n;
    base %= mod;
    while (exp > 0n) {
        if (exp % 2n === 1n)
            result = (result * base) % mod;
        exp >>= 1n;
        base = (base * base) % mod;
    }
    return result;
}

// ================= KEY GENERATION =================
function generateKeys() {

    let p = BigInt(document.getElementById("pInput").value);
    let q = BigInt(document.getElementById("qInput").value);
    e = BigInt(document.getElementById("eInput").value);

    let validation = document.getElementById("validationMsg");
    validation.innerHTML = "";

    if (!isPrime(p)) {
        let sug = nearestPrime(p);
        validation.innerHTML += `p kh√¥ng ph·∫£i SNT. G·ª£i √Ω: ${sug.lower} ho·∫∑c ${sug.upper}<br>`;
    }

    if (!isPrime(q)) {
        let sug = nearestPrime(q);
        validation.innerHTML += `q kh√¥ng ph·∫£i SNT. G·ª£i √Ω: ${sug.lower} ho·∫∑c ${sug.upper}<br>`;
    }

    if (validation.innerHTML !== "") return;

    n = p * q;
    let phi = (p - 1n) * (q - 1n);

    if (n <= 255n) {
        validation.innerHTML = `n = ${n} qu√° nh·ªè. C·∫ßn n > 255 ƒë·ªÉ m√£ h√≥a ASCII.`;
        return;
    }

    if (gcd(e, phi) !== 1n) {
        validation.innerHTML = "e kh√¥ng nguy√™n t·ªë c√πng phi(n)";
        return;
    }

    d = modInverse(e, phi);

    document.getElementById("nValue").innerText = n;
    document.getElementById("phiValue").innerText = phi;
    document.getElementById("dValue").innerText = d;
}

// ================= ENCRYPT =================
function encrypt() {
    if (!n || !e) return alert("H√£y t·∫°o kh√≥a tr∆∞·ªõc!");

    let text = document.getElementById("textInput").value;
    let result = [];

    for (let i = 0; i < text.length; i++) {
        let m = BigInt(text.charCodeAt(i));
        if (m >= n) {
            alert("K√Ω t·ª± c√≥ m√£ ASCII ‚â• n. H√£y ch·ªçn p, q l·ªõn h∆°n.");
            return;
        }
        let c = modPow(m, e, n);
        result.push(c.toString());
    }

    document.getElementById("cipherInput").value = result.join(" ");
}

// ================= DECRYPT =================
function decrypt() {
    if (!d) return alert("H√£y t·∫°o kh√≥a tr∆∞·ªõc!");

    let parts = document.getElementById("cipherInput").value.split(" ");
    let result = "";

    for (let part of parts) {
        if (part.trim() === "") continue;
        let m = modPow(BigInt(part), d, n);
        result += String.fromCharCode(Number(m));
    }

    document.getElementById("result").innerText = "Gi·∫£i m√£: " + result;
}

function useCommonE() {
    document.getElementById("eInput").value = 65537;
}

</script>

</body>
</html>
